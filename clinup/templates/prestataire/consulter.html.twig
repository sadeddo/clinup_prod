{% extends 'base1.html.twig' %}

{% block title %}Détails du prestataire{% endblock %}

{% block body %}
<style>
@media (max-width: 768px) {
    .card-body .btn {
        font-size: 14px;
        padding: 8px;
    }
    .card-body img {
        width: 80px !important;
        height: 80px !important;
    }
}
</style>
<main class="main-container py-4">
    <div class="container-fluid px-3 px-md-5">
        <h2 class="fw-bold mb-4">Profil d’agent : {{ presta.firstname }} {{ presta.lastname }}</h2>

        <div class="card shadow-sm rounded mb-4">
    <div class="card-body">
        <div class="row align-items-center g-4 text-center text-md-start">
            <div class="col-12 col-md-auto">
                <img src="{{ asset('img/' ~ presta.picture) }}" class="rounded-circle border" style="width: 100px; height: 100px;" alt="Photo de profil">
            </div>

            <div class="col-12 col-md">
                <div class="d-flex justify-content-center justify-content-md-start align-items-center mb-2">
                    <h5 class="mb-0 me-2">{{ presta.firstname }} {{ presta.lastname }}</h5>
                    <i class="bi bi-patch-check-fill text-primary"></i>
                </div>
                <p class="mb-1">
                    <i class="bi bi-star-fill text-warning"></i>
                    {{ average | number_format(1, '.', '') }}
                </p>
                <p class="text-muted mb-2">{{ presta.description }}</p>
            </div>

            <div class="col-12 col-md-auto d-flex flex-column gap-2 mt-2 mt-md-0">
                <a href="{{ path('app_reservation_ajouter_direct', {'id': presta.id}) }}" class="btn btn-secondary w-100">Faire une demande</a>
                <a href="{{ path('app_conversation_id', {'id': presta.id}) }}" class="btn btn-outline-primary w-100">
                    <i class="bi bi-chat-dots"></i> Contacter
                </a>
            </div>
        </div>
    </div>
</div>


        
        {# Expériences #}
        <div class="card shadow-sm rounded mb-4">
            <div class="card-body">
                <h5 class="fw-semibold mb-3">Expériences</h5>
                {% for experience in presta.experiences %}
                    <div class="mb-2">
                        <strong>{{ experience.experience }}</strong>
                        <small class="text-muted"> | {{ experience.dtStart|date('Y-m') }} à {{ experience.dtEnd|date('Y-m') }}</small>
                        <p class="mb-1">{{ experience.description }}</p>
                        <hr>
                    </div>
                {% else %}
                    <p class="text-muted">Aucune expérience enregistrée.</p>
                {% endfor %}
            </div>
        </div>

        {# Commentaires #}
        <div class="card shadow-sm rounded mb-4">
            <div class="card-body">
                <h5 class="fw-semibold mb-3">Avis et commentaires</h5>
                {% for comment in presta.getCommentPrestas() %}
                    <div class="d-flex mb-2">
                        <img src="{{ asset('img/' ~ comment.client.picture) }}" alt="Avatar" class="rounded-circle me-3" style="width: 40px; height: 40px;">
                        <div>
                            <h6 class="mb-0">{{ comment.client.firstname }} {{ comment.client.lastname }}</h6>
                            <div>
                                {% for i in 1..5 %}
                                    <span style="color: {{ i <= comment.evaluation ? 'gold' : 'grey' }}">★</span>
                                {% endfor %}
                            </div>
                            <small class="text-muted">{{ comment.createdAt|date('d M Y - H:i') }}</small>
                        </div>
                    </div>
                    <p class="ms-5">{{ comment.comment }}</p>

                    {% if comment.reponse %}
                        <div class="d-flex ms-5">
                            <img src="{{ asset('img/' ~ comment.prestataire.picture) }}" class="rounded-circle me-2" style="width: 40px; height: 40px;" alt="Avatar">
                            <div>
                                <h6 class="mb-1">Réponse de l'agent</h6>
                                <p>{{ comment.reponse }}</p>
                            </div>
                        </div>
                    {% endif %}
                    <hr>
                {% else %}
                    <p class="text-muted">Aucun commentaire enregistré.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</main>

{# FullCalendar JS + CSS #}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    const isMobile = window.innerWidth <= 768;

    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: isMobile ? 'timeGridDay' : 'timeGridWeek',
        locale: 'fr',
        height: 'auto',
        slotMinTime: "07:00:00",
        slotMaxTime: "19:00:00",
        events: {{ disposJson|raw }},
        eventColor: '#198754',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'timeGridWeek,timeGridDay'
        },
        allDaySlot: false,
        nowIndicator: true,
        expandRows: true,
        dayMaxEventRows: true,
    });

    calendar.render();
});

</script>
{% endblock %}
